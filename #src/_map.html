<script src="https://api-maps.yandex.ru/2.1/?apikey=d02ef18b-3f8a-40d8-ad6a-d6aad95f6099&lang=ru_RU"></script>
<script>
    let locations = [
        {
            "id": 1,
            "districtId": 1,
            "coords": [56.318801, 43.955292],
            "title": 'Нижегородский планетарий им. Г. М. Гречко',
            "address": 'ул. Революционная, д. 20',
            "hours": "Вт–Вс 10:00–20:00",
        },
        {
            "id": 2,
            "districtId": 1,
            "coords": [56.288914, 43.855143],
            "title": 'Центральная районная библиотека им. Ф. М. Достоевского',
            "address": 'ул. Гороховецкая, д. 18А',
            "hours": "Вт–Пт 9:30–19:00; Вс 9:30–17:00"
        },
        {
            "id": 3,
            "districtId": 1,
            "coords": [56.328324, 43.961313],
            "title": 'Название локации',
            "address": 'ул. Совнаркомовская, 13',
            "hours": "Пн–Пт 09:00–18:00"
        },
        {
            "id": 4,
            "districtId": 6,
            "coords": [56.293337, 44.013856],
            "title": 'Название локации',
            "address": 'Советский район, 13',
            "hours": "Пн–Пт 09:00–18:00"
        }
    ]
</script>
<script>
    let center = [56.326797, 44.006516];  
    let locMap
    let locGeoObjects = []  
    let maxZoom = 15
    function setmapDefaults(map) {
        map.controls.remove('geolocationControl'); // удаляем геолокацию
        map.controls.remove('searchControl'); // удаляем поиск
        map.controls.remove('trafficControl'); // удаляем контроль трафика
        map.controls.remove('typeSelector'); // удаляем тип
        map.controls.remove('fullscreenControl'); // удаляем кнопку перехода в полноэкранный режим
        map.controls.remove('rulerControl'); // удаляем контрол правил
        map.controls.remove('zoomControl');
        map.margin.setDefaultMargin(100);
    }   
    function locMapInit() {
        locMap = new ymaps.Map('loc-map', {
            center,
            zoom: 6,
        },{
            suppressMapOpenBlock: true,
            suppressObsoleteBrowserNotifier:true,
            yandexMapDisablePoiInteractivity: true, 
        });
        setmapDefaults(locMap)
        if (locations.length)  {
            locations.forEach((item,i) => {
                locGeoObjects[i] = new ymaps.Placemark(item.coords, 
                    {
                        balloonContent: `
                        <div class="balloon loc-baloon">
                            <div class="balloon__header">
                                <p class="accent balloon__name">${item.title}</p>
                            </div>
                            <div class="balloon__body">
                                ${item.address ? `<p>
                                    <span>Адрес:</span>
                                    <span>${item.address}</span>
                                </p>` : ''}
                                 ${item['hours'] ?  `<p>
                                    <span>Режим работы:</span>
                                    <span>${item['hours']}</span>
                                </p>` : ""
                                }
                            </div>
                        </div>`,
                    }, 
                    {
                        balloonPanelMaxMapArea: window.innerWidth < 767.98 ? Infinity : 0,
                        iconLayout: "default#image",
                        iconImageHref: "img/svg/map-marker.svg",
                        iconImageSize: window.innerWidth < 767.98 ? [10, 30] : [21, 61],
                        iconImageOffset: window.innerWidth < 767.98 ? [-5, -30] : [-10.5, -61],
                        cursor: "pointer",
                        hideIconOnBalloonOpen: false,
                        balloonOffset: [90,0]
                    }
                )
            })
            locGeoObjects.forEach(item => locMap.geoObjects.add(item))
            locMap.setBounds(locMap.geoObjects.getBounds(), {checkZoomRange: true, zoomMargin: 100})
            locMap.events.add('click',()=> locMap.balloon.close())
        }
    } 
    if (document.querySelector("#loc-map")) {
        ymaps.ready(() => {
            locMapInit()
        });
        let mapTimeout
        window.addEventListener("resize", () => {
            clearTimeout(mapTimeout)
            if (locMap) {
                locMap.destroy()
            }
            mapTimeout = setTimeout(() => {
                locMapInit()
            }, 300);
        })
    }
</script>